import{_ as l}from"./chunks/plugin-vue_export-helper.DlAUqK2U.js";import{A as o,b as c,k as i,d as s,e as r,ah as d,l as a,m as n,g as p,ai as h}from"./chunks/chartjs.CT3i_C7A.js";const C=JSON.parse('{"title":"ðŸ“¦ Upgrading from v2.x to v3.x","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"guide/v3-upgrade.md","filePath":"guide/v3-upgrade.md","lastUpdated":1770987349000}'),k={name:"guide/v3-upgrade.md"};function g(u,e,m,E,y,f){const t=o("Mermaid");return i(),c("div",null,[e[1]||(e[1]=s("h1",{id:"ðŸ“¦-upgrading-from-v2-x-to-v3-x",tabindex:"-1"},[a("ðŸ“¦ Upgrading from v2.x to v3.x "),s("a",{class:"header-anchor",href:"#ðŸ“¦-upgrading-from-v2-x-to-v3-x","aria-label":'Permalink to "ðŸ“¦ Upgrading from v2.x to v3.x"'},"â€‹")],-1)),e[2]||(e[2]=s("p",null,[a("v3.0.0 introduces fundamental architectural changes: strategy packages, a new caching system, centralized locale management via "),s("code",null,"useI18nLocale()"),a(", and a redesigned redirect pipeline. This section covers all breaking changes and how to update your code.")],-1)),e[3]||(e[3]=s("h2",{id:"migration-steps",tabindex:"-1"},[a("Migration Steps "),s("a",{class:"header-anchor",href:"#migration-steps","aria-label":'Permalink to "Migration Steps"'},"â€‹")],-1)),(i(),r(h,null,{default:n(()=>[p(t,{id:"mermaid-9",class:"mermaid-chart",graph:"flowchart%20LR%0A%20%20%20%20A%5B%221.%20Update%20deps%22%5D%20--%3E%20B%5B%222.%20Fix%20config%22%5D%20--%3E%20C%5B%223.%20Update%20plugins%22%5D%20--%3E%20D%5B%224.%20Test%22%5D%20--%3E%20E%5B%22%E2%9C%85%20Done%22%5D%0A"})]),fallback:n(()=>[...e[0]||(e[0]=[a(" Loading... ",-1)])]),_:1})),e[4]||(e[4]=d(`<h2 id="breaking-changes-summary" tabindex="-1">Breaking Changes Summary <a class="header-anchor" href="#breaking-changes-summary" aria-label="Permalink to &quot;Breaking Changes Summary&quot;">â€‹</a></h2><ul><li><strong>Locale state</strong> â€” <code>useState</code> / <code>useCookie</code> manually â†’ <code>useI18nLocale()</code> composable</li><li><strong>Config access</strong> â€” <code>useRuntimeConfig().public.i18nConfig</code> â†’ <code>getI18nConfig()</code> from <code>#build/i18n.strategy.mjs</code></li><li><strong>Redirect component</strong> â€” <code>fallbackRedirectComponentPath</code> option â†’ Server middleware + client plugin (automatic)</li><li><strong><code>includeDefaultLocaleRoute</code></strong> â€” Supported (deprecated) â†’ Removed, use <code>strategy</code> option</li><li><strong><code>experimental.hmr</code></strong> â€” Under <code>experimental</code> â†’ Root-level option</li><li><strong><code>previousPageFallback</code></strong> â€” Removed entirely (cumulative merge strategy handles this automatically)</li><li><strong>Caching</strong> â€” <code>useStorage(&#39;cache&#39;)</code> â†’ <code>TranslationStorage</code> singleton (<code>Symbol.for</code> on <code>globalThis</code>)</li><li><strong>SSR transfer</strong> â€” Runtime config â†’ <code>window.__I18N__</code> script injection</li><li><strong>Strategy classes</strong> â€” Internal â†’ Separate packages (<code>@i18n-micro/route-strategy</code>, <code>@i18n-micro/path-strategy</code>)</li></ul><h2 id="removed-fallbackredirectcomponentpath" tabindex="-1">Removed: <code>fallbackRedirectComponentPath</code> <a class="header-anchor" href="#removed-fallbackredirectcomponentpath" aria-label="Permalink to &quot;Removed: \`fallbackRedirectComponentPath\`&quot;">â€‹</a></h2><p>The <code>fallbackRedirectComponentPath</code> option and the <code>locale-redirect.vue</code> fallback component have been removed. Redirect logic is now handled by:</p><ol><li><strong>Server middleware</strong> (<code>i18n.global.ts</code>) â€” sets <code>event.context.i18n.locale</code></li><li><strong>Redirect plugin</strong> (<code>06.redirect.ts</code>) â€” handles 302 redirects on server (before render) and client (after hydration)</li></ol><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i18n: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   strategy: &#39;prefix_except_default&#39;,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  fallbackRedirectComponentPath: &#39;~/components/MyRedirect.vue&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><p>If you had custom redirect logic in the fallback component, implement it in a server plugin instead:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// plugins/i18n-loader.server.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineNuxtPlugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;i18n-custom-redirect&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  enforce: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pre&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  order: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setLocale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useI18nLocale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Your custom detection logic</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setLocale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(detectedLocale)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h2 id="removed-includedefaultlocaleroute" tabindex="-1">Removed: <code>includeDefaultLocaleRoute</code> <a class="header-anchor" href="#removed-includedefaultlocaleroute" aria-label="Permalink to &quot;Removed: \`includeDefaultLocaleRoute\`&quot;">â€‹</a></h2><p>Use the <code>strategy</code> option instead:</p><ul><li><code>includeDefaultLocaleRoute: true</code> â†’ <code>strategy: &#39;prefix&#39;</code></li><li><code>includeDefaultLocaleRoute: false</code> â†’ <code>strategy: &#39;prefix_except_default&#39;</code> (the default)</li></ul><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i18n: {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  includeDefaultLocaleRoute: true,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  strategy: &#39;prefix&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><h2 id="config-access-geti18nconfig-replaces-useruntimeconfig" tabindex="-1">Config Access: <code>getI18nConfig()</code> replaces <code>useRuntimeConfig</code> <a class="header-anchor" href="#config-access-geti18nconfig-replaces-useruntimeconfig" aria-label="Permalink to &quot;Config Access: \`getI18nConfig()\` replaces \`useRuntimeConfig\`&quot;">â€‹</a></h2><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- const config = useRuntimeConfig()</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- const cookieName = config.public.i18nConfig?.localeCookie || &#39;user-locale&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ import { getI18nConfig } from &#39;#build/i18n.strategy.mjs&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ const { localeCookie: configCookie } = getI18nConfig()</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ const cookieName = configCookie ?? &#39;user-locale&#39;</span></span></code></pre></div><h2 id="locale-management-usei18nlocale-replaces-manual-state" tabindex="-1">Locale Management: <code>useI18nLocale()</code> replaces manual state <a class="header-anchor" href="#locale-management-usei18nlocale-replaces-manual-state" aria-label="Permalink to &quot;Locale Management: \`useI18nLocale()\` replaces manual state&quot;">â€‹</a></h2><p>In v2, you may have used <code>useState(&#39;i18n-locale&#39;)</code> or <code>useCookie(&#39;user-locale&#39;)</code> directly. In v3, use the centralized <code>useI18nLocale()</code> composable:</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- const locale = useState(&#39;i18n-locale&#39;)</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- const cookie = useCookie(&#39;user-locale&#39;)</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- locale.value = &#39;fr&#39;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- cookie.value = &#39;fr&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ const { setLocale } = useI18nLocale()</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ setLocale(&#39;fr&#39;) // Updates both state and cookie atomically</span></span></code></pre></div><p>See <a href="/nuxt-i18n-micro/guide/custom-auto-detect">Custom Language Detection</a> for detailed examples.</p><h2 id="experimental-options-moved-removed" tabindex="-1">Experimental Options Moved / Removed <a class="header-anchor" href="#experimental-options-moved-removed" aria-label="Permalink to &quot;Experimental Options Moved / Removed&quot;">â€‹</a></h2><p><code>hmr</code> has moved from <code>experimental</code> to root-level. <code>previousPageFallback</code> has been removed entirely â€” the module now uses a cumulative deep merge strategy (2-level depth) that automatically preserves translations from the previous page during transition animations, even when pages share overlapping nested keys. After the transition animation completes, the <code>page:transition:finish</code> hook cleans up old-page keys from memory.</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i18n: {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  experimental: {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-    hmr: true,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-    previousPageFallback: true</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  }</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  hmr: true,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  // previousPageFallback removed â€” handled automatically</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><h2 id="redirect-architecture-v3" tabindex="-1">Redirect Architecture (v3) <a class="header-anchor" href="#redirect-architecture-v3" aria-label="Permalink to &quot;Redirect Architecture (v3)&quot;">â€‹</a></h2><p>Redirects are now handled automatically by two components:</p><ol><li><strong>Server-side</strong> (<code>06.redirect.ts</code>): Runs during SSR, issues 302 redirects before any page rendering â€” no &quot;error flash&quot;</li><li><strong>Client-side</strong> (<code>06.redirect.ts</code>): Runs after hydration (<code>app:mounted</code>) and on SPA navigation (<code>router.afterEach</code>)</li></ol><p>Locale priority for redirects:</p><ol><li><code>useState(&#39;i18n-locale&#39;)</code> â€” set via <code>useI18nLocale().setLocale()</code></li><li>Cookie â€” if <code>localeCookie</code> is configured</li><li><code>Accept-Language</code> header â€” if <code>autoDetectLanguage: true</code></li><li><code>defaultLocale</code> â€” fallback</li></ol><p>No code changes required for standard setups.</p><div class="warning custom-block"><p class="custom-block-title"><code>localeCookie</code> for prefix strategies</p><p>For <code>prefix</code> and <code>prefix_except_default</code> strategies with <code>redirects: true</code>, set <code>localeCookie: &#39;user-locale&#39;</code> to enable locale persistence across page reloads. Without it, redirects only use <code>Accept-Language</code> or <code>defaultLocale</code>.</p></div><h2 id="typescript-internal-module-types-optional" tabindex="-1">TypeScript: Internal Module Types (optional) <a class="header-anchor" href="#typescript-internal-module-types-optional" aria-label="Permalink to &quot;TypeScript: Internal Module Types (optional)&quot;">â€‹</a></h2><p>If you encounter type errors related to internal imports like <code>#i18n-internal/plural</code>, <code>#i18n-internal/strategy</code>, or <code>#i18n-internal/config</code>, add the <code>imports</code> section to your project&#39;s <code>package.json</code>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;imports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;#i18n-internal/plural&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nuxt-i18n-micro/internals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;#i18n-internal/strategy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nuxt-i18n-micro/internals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;#i18n-internal/config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nuxt-i18n-micro/internals&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This is <strong>not required</strong> in most cases â€” Nuxt resolves these automatically at build time. Add this only if your IDE or <code>vue-tsc</code> reports unresolved module errors.</p></div>`,32))])}const x=l(k,[["render",g]]);export{C as __pageData,x as default};
